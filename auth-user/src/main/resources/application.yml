# ======================================================
# Auth User Service - Application Configuration
# ======================================================

server:
  port: 9001
  servlet:
    context-path: /
  forward-headers-strategy: framework
  tomcat:
    remoteip:
      remote-ip-header: X-Forwarded-For
      protocol-header: X-Forwarded-Proto

# ======================================================
# Spring Core Configuration
# ======================================================
spring:
  application:
    name: auth-user

  docker:
    compose:
      enabled: false

  # =======================
  # Database
  # =======================
  datasource:
    url: ${DB_URL:jdbc:postgresql://localhost:5433/authdb}
    username: ${DB_USERNAME:ev}
    password: ${DB_PASSWORD:evpass}
    driver-class-name: org.postgresql.Driver

  # =======================
  # JPA / Hibernate
  # =======================
  jpa:
    hibernate:
      ddl-auto: none
    show-sql: false
    properties:
      hibernate:
        format_sql: false
        dialect: org.hibernate.dialect.PostgreSQLDialect

  # =======================
  # Flyway
  # =======================
  flyway:
    enabled: true
    baseline-on-migrate: true
    clean-disabled: true

  # =======================
  # Kafka
  # =======================
  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}

    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer
      acks: all
      retries: 3
      compression-type: snappy
      enable-idempotence: true
      properties:
        spring.json.add.type.headers: false
        spring.json.type.mapping: >
          emailEvent:com.boilerplate.auth.model.event.EmailEvent,
          supportTicketEvent:com.boilerplate.auth.model.event.SupportTicketEvent

    consumer:
      group-id: auth-user-service
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer
      auto-offset-reset: earliest
      properties:
        spring.json.trusted.packages: "*"
        spring.json.type.mapping: >
          emailEvent:com.boilerplate.auth.model.event.EmailEvent,
          supportTicketEvent:com.boilerplate.auth.model.event.SupportTicketEvent

    listener:
      ack-mode: manual
      missing-topics-fatal: false

  # =======================
  # Mail
  # =======================
  mail:
    host: smtp.gmail.com
    port: 587
    username: ${MAIL_USERNAME}
    password: ${MAIL_PASSWORD}
    properties:
      mail.smtp:
        auth: true
        starttls.enable: true
        timeout: 5000
        connectiontimeout: 5000
        writetimeout: 5000

  # =======================
  # OAuth2 - Google
  # =======================
  security:
    oauth2:
      client:
        registration:
          google:
            client-id: ${GOOGLE_CLIENT_ID}
            client-secret: ${GOOGLE_CLIENT_SECRET}
            scope: [ email, profile, openid ]
            redirect-uri: ${OAUTH2_REDIRECT_URI:http://localhost:9001/oauth2/callback}
        provider:
          google:
            authorization-uri: https://accounts.google.com/o/oauth2/v2/auth
            token-uri: https://oauth2.googleapis.com/token
            user-info-uri: https://www.googleapis.com/oauth2/v3/userinfo
            user-name-attribute: sub

  # =======================
  # Redis
  # =======================
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}

# ======================================================
# Eureka
# ======================================================
eureka:
  client:
    service-url:
      defaultZone: ${EUREKA_SERVER_URL:http://localhost:8761/eureka/}
    register-with-eureka: true
    fetch-registry: true
  instance:
    prefer-ip-address: true
    instance-id: ${spring.application.name}:${random.value}

# ======================================================
# JWT
# ======================================================
jwt:
  secret: ${JWT_SECRET}
  access-token-expiration: ${JWT_ACCESS_TOKEN_EXPIRATION:3600000}
  refresh-token-expiration: ${JWT_REFRESH_TOKEN_EXPIRATION:604800000}

# ======================================================
# OTP
# ======================================================
otp:
  expiration-minutes: ${OTP_EXPIRATION_MINUTES:5}
  length: ${OTP_LENGTH:6}

# ======================================================
# Application Custom Config
# ======================================================
app:
  name: EV Battery Swap Station Management System
  frontend-url: ${FRONTEND_URL:http://localhost:5173}
  verification-token-expiration-hours: ${VERIFICATION_TOKEN_EXPIRATION_HOURS:48}
  kafka:
    enabled: ${KAFKA_ENABLED:false}
    topics:
      support-ticket-created: support.ticket.created
      support-ticket-updated: support.ticket.updated
      email-notification: notification.email

# ======================================================
# Swagger / OpenAPI
# ======================================================
springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /swagger-ui.html
    operations-sorter: method
    tags-sorter: alpha
    doc-expansion: none

# ======================================================
# AWS S3
# ======================================================
aws:
  region: ap-southeast-2
  s3:
    bucket-name: shoe-store-images-newbie
  access-key: ${S3_ACCESS_KEY}
  secret-key: ${S3_SECRET}

# ======================================================
# Logging
# ======================================================
logging:
  level:
    root: INFO
    com.boilerplate.auth: DEBUG
